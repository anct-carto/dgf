<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Le grand débat national</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="shortcut icon" type="image/png" href="img/logo.png"/>
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="src/leaflet-search.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" />
	<link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
    <!--[if lte IE 8]><link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->

    <link rel="stylesheet" href="src/leaflet-sidebar.css" />
	<link rel="stylesheet" href="style.css" />
	
</head>

<body>

    <div id="sidebar" class="sidebar collapsed">
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab" id="logo"><i class="fa fa-home"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1><img src="img/Logo_Grand_Debat_National.png" alt="" width="350px"/>
				<span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
				
				<div class="presentation" id="defaut">
					
					<div>
						<p><strong>Carte interactive de téléchargement des kits cartographiques "mon territoire en carte"</strong></p>
						<i>Cliquez sur le territoire qui vous concerne, ou rechercher un nom d'epci</i>
					</div>
					<div id="legende">
			
					</div>
					<br/>
					<div id="sources">
					<p><i><a href="https://cartotheque.cget.gouv.fr/cartes" style="text-decoration:none;" target="_blank ">Retrouver les kits sur la cartothèque du CGET</a></i></p>
					</div>
				</div>

				<div class="ol-popup" id="popup">
					<div id="titre"></div>
					<div id="internet"></div>
				</div>
					
            </div>

        </div>
    </div>

	<div id="mapid"></div>

    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>
	<script src="src/leaflet-search.js"></script>
    <script src="https://turbo87.github.io/sidebar-v2/js/leaflet-sidebar.js"></script>
	<script type="text/javascript" src="data/masque.js"></script>
	<script type="text/javascript" src="data/departement.js"></script>
	<script type="text/javascript" src="data/region.js"></script>
	<script type="text/javascript" src="data/epci.js"></script>
	<script type="text/javascript" src="data/commune.js"></script>
	
    <script>
		
			
		// Création de la carte
		var map = L.map('mapid', {maxZoom:18, minZoom:6 })
		.setView([46.5, 2], 6);
		map.zoomControl.setPosition('topright');
		
		var GeoportailFrance_parcels = L.tileLayer('https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=CADASTRALPARCELS.PARCELS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}', {
		attribution: '',
		apikey: 'choisirgeoportail',
		format: 'image/png',
		style: 'bdparcellaire'
		});
		
		//GeoportailFrance_parcels.addTo(map);
		
		//Ajout des couches du fond de carte
		Cache = L.geoJSON(JS_masque, {color: "#154463", weight: 0, opacity: 1, fillOpacity: 1}).addTo(map);
		Fond_Regions = L.geoJSON(JS_reg, {weight: 0, opacity: 1, fillOpacity: 1, fillColor:"#ffffff"}).addTo(map);
		//Commune = L.geoJSON(JS_com);
		
		EPCI = L.geoJSON(JS_epci, {
			style : {weight: 1, color: "#3e62a4", opacity: 1, fillOpacity: 1, fillColor:"#00bdce"},
			onEachFeature: function(feature, layer) {layer.bindTooltip(feature.properties.libgeo, {className: 'Tooltips'}); layer.on('click', function(e) {popup(feature.properties)})}
		}).addTo(map);
		
		Contour_Regions = L.geoJSON(JS_reg, {interactive: false, color: "#003b5e", weight: 1, opacity: 1, fillOpacity: 0} ).addTo(map);
		Departements = L.geoJSON(JS_dep, {
			style:{interactive: false, color: "#003b5e", weight: 0.5, opacity: 1, fillOpacity: 0}
		}).addTo(map);
		
		//Ajout du logo sur la carte
		var imageUrl = 'img/Logo_Grand_Debat_National.png',
		imageBounds = [[51, -4.7],[50, 0]];
		L.imageOverlay(imageUrl, imageBounds, {zIndex : '1000'} ).addTo(map);
		
		//Ajout de la sidebar
		var sidebar = L.control.sidebar('sidebar').addTo(map);
		
		
		//Action au clic sur un marker
		function popup(e) {
			
			if (document.getElementById('sidebar').classList.contains('collapsed')){
				sidebar.open('home');
				}
			
			//Remplissage de la popup
			document.getElementById('popup').style.display = "block";
			document.getElementById('defaut').style.display = "none";
			
			document.getElementById('titre').innerHTML = "<h1 style='#ffffff'>"+e.libgeo+"</h1>";
			document.getElementById('internet').innerHTML = "<h2>Télécharger le kit</h2><p>"+e.nomfic+"</p>";		

		}

		/*Events au clic sur la carte
		map.on('click', function(e) { 
			//L.DomEvent.stop(e);
			//fermer ou ouvrir la sidebar
			if (document.getElementById('sidebar').classList.contains('collapsed')) {
				sidebar.open('home');
			}
			else {
				sidebar.close();
			}
			//remettre le texte d'intro
			document.getElementById('popup').style.display = "none";
			document.getElementById('defaut').style.display = "block";
		});*/
		
		//Barre de recherche
		var Recherche = L.layerGroup([EPCI]);
		
		L.control.search({
			layer: Recherche,
			initial: false,
			zoom: 10,
			position:'topright',
			propertyName: 'libgeo'
		})
		.addTo(map);
		
		

   </script>
	
</body>



</html>
